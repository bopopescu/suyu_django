{% extends 'newindex.html' %}{% block nav_hefu_plan %}active{% endblock %}{% block nav_hefu_search %}active{% endblock %}{% block head %}    <link href="/static/css/saltstack/plugins/iCheck/custom.css" rel="stylesheet" xmlns="http://www.w3.org/1999/html"          xmlns="http://www.w3.org/1999/html" xmlns="http://www.w3.org/1999/html">    <link href="/static/css/saltstack/plugins/footable/footable.core.css" rel="stylesheet">    <link href="/static/css/saltstack/plugins/datapicker/datepicker3.css" rel="stylesheet">{%  endblock %}{% block re_content %}<div class="row">    <div class="col-lg-12">        <div class="wrapper wrapper-content animated  ecommerce">            <div class="ibox-title">                <h5>Merge game plan</h5>            </div>            <div class="ibox-content m-b-sm border-bottom">            <div class="row">                    <div class="col-sm-4">                        <div class="form-group">                            <div class="input-group date">                                <span class="input-group-addon"><i class="fa fa-calendar"></i></span><input id="date_added" type="text" class="form-control" value="03/04/2014">                            </div>                        </div>                    </div>                    <div class="col-sm-4">                        <div class="form-group">                            <div class="input-group date">                                <span class="input-group-addon"><i class="fa fa-calendar"></i></span><input id="date_modified" type="text" class="form-control" value="03/06/2014">                            </div>                        </div>                    </div>                    <div class="col-sm-2">                        <div class="form-group">                            <select name="status" id="status" class="form-control">                                <option value="1" selected="">申请合服</option>                                <option value="0">完成合服</option>                            </select>                        </div>                    </div>                    <div class="col-sm-2">                        <div class="form-group">                            <button data-toggle="button" class="btn btn-primary btn-outline" type="button">Search</button>                        </div>                    </div>                </div>            </div>            <div class="row">                <div class="col-lg-2">                    <div class="form-group">                        <button data-toggle="button" class="btn btn-primary btn-w-m " type="button" id="hefuajax">开始合服</button>                    </div>                </div>                <div class="col-lg-6"></div>                <div class="col-lg-2">{#                    <div class="form-group">#}{#                        <button data-toggle="button" class="btn btn-warning btn-w-m" type="button" id="hefu_stop">停服</button>#}{#                    </div>#}                    <div class="form-group">                        <select name="status" id="action" class="form-control">                            {% for module in modules %}                            <option value="{{module.action}}" cmd="{{ module.cmd }}" isargv="{{module.ArgvCount}}">{{module.name}}</option>                            {% endfor %}                        </select>                    </div>                </div>                <div class="col-lg-1">                    <div class="form-group">                        <button data-toggle="button" class="btn btn-info btn-w-m" type="button" id="run">运行</button>                    </div>                </div>            </div>            <div class="row">                <div class="col-lg-12">                    <div class="ibox float-e-margins">                        <div class="ibox-content">                            <div class="tabs-container">                                <ul class="nav nav-tabs" id="myTables">                                    <li class="active"><a data-toggle="tab" href="#tab-1">合服列表</a></li>                                    <li class=""><a data-toggle="tab" href="#tab-2">输出结果</a></li>                                </ul>                                <div class="tab-content">                                    <div id="tab-1" class="tab-pane active">                                        <div class="panel-body">                                            <div class="table-responsive">                                                <table class="table table-striped">                                                    <thead>                                                    <tr>                                                        <th><input type="checkbox"  checked class="i-checks" name="select_all" value="">全选</th>                                                        <th>ID</th>                                                        <th>申请时间</th>                                                        <th>平台</th>                                                        <th>主区服</th>                                                        <th>合并服 </th>                                                        <th>主区服IP</th>                                                        <th>合服时间</th>                                                        <th>状态</th>                                                    </tr>                                                    </thead>                                                    <tbody>                                                    {% for hefu_data in hefu_datas %}                                                        <tr hefuid="{{ hefu_data.hefuid }}">                                                            <td><input type="checkbox" checked class="i-checks" name="select_hefu" value="{{ hefu_data.hefuid }}"></td>                                                            <td>{{ hefu_data.hefuid}}</td>                                                            <td>{{ hefu_data.apply_time }}</td>                                                            <td>{{ hefu_data.platform }}</td>                                                            <td>{{ hefu_data.server_id }}</td>                                                            <td>{{ hefu_data.server_ids }}</td>                                                            <td>{{ hefu_data.main_server_ip }}</td>                                                            <td>{{ hefu_data.combine_time }}</td>                    {#                                        <td>{% if hefu_data.status == 1 %}申请合服{% elif hefu_data.status == 2 %}合服完毕{% elif hefu_data.status == 3 %}取消合服{% endif %}</td>#}                    {#                                        <td>{% if hefu_data.status <= 1 %}{% endif %}</td>#}                                                            <td>{{ hefu_data.status }}</td>                                                        </tr>                                                    {% endfor %}                                                    </tbody>                                                </table>                                                </div>                                            </div>                                        </div>                                    <div id="tab-2" class="tab-pane">                                        <div class="panel-body">                                            <pre id="result_html"></pre>                                        </div>                                    </div>                                </div>                            </div>                        </div>                    </div>                </div>            </div>        </div>    </div></div>{% endblock %}{% block js %}    <script src="/static/js/saltstack/plugins/iCheck/icheck.min.js"></script>    <script src="/static/js/saltstack/plugins/datapicker/bootstrap-datepicker.js"></script>    <script src="/static/js/saltstack/plugins/footable/footable.all.min.js"></script>{% endblock %}{% block scripts %}{#    <script>#}{#        $(document).ready(function(){#}{#            $('.i-checks').iCheck({#}{#                checkboxClass: 'icheckbox_square-green',#}{#                radioClass: 'iradio_square-green',#}{#            });#}{#        });#}{#    </script>#}<script>    $(document).ready(function() {        $('.footable').footable();        $('#date_added').datepicker({            todayBtn: "linked",            keyboardNavigation: false,            forceParse: false,            calendarWeeks: true,            autoclose: true        });        $('#date_modified').datepicker({            todayBtn: "linked",            keyboardNavigation: false,            forceParse: false,            calendarWeeks: true,            autoclose: true        });    });</script><script type="text/javascript">    $(function (){        $("#hefuajax").click(function(){            var exit_id = $(this).parents().parents().attr("hefuid")            console.log(exit_id)            var data={'hefuid':[],'ip':[]}            $("input[name='select_hefu']").each(function () {                if ($(this).is(":checked")==true){                    data["hefuid"].push($(this).val());                    val = $(this).parents('tr').children().eq(6).html()                    data['ip'].push(val);                }            })            var html = $.ajax({                type: "POST",                url: "HefuInput",                data: JSON.stringify(data),                dataType: 'JSON',                success:function (data) {                    console.log(data)                    data_type = Object.prototype.toString.apply(data);                    console.log(data_type)                }            })         });    });    </script><script>    $("#run").click(function () {        var data={'stop_id':[],'action':[]}        $("input[name='select_hefu']").each(function () {            if ($(this).is(":checked")==true){                data["stop_id"].push($(this).val());                var action = $("#action").val();                data["action"]=action            }        })        var html = $.ajax({            type: "POST",                url: "game_action",                data: JSON.stringify(data),                dataType: 'JSON',                success:function (data) {                    $('#myTables a[href="#tab-2"]').tab('show');                    console.log(data)                    $("#result_html").html(data);                }        })    })</script><script>    $("input[name='select_all']").change(function(){        if ($(this).is(":checked") == true) {            $("input[name='select_hefu']").prop("checked",true);        }else{            $("input[name='select_hefu']").prop("checked",false);        }    })</script>{% endblock %}