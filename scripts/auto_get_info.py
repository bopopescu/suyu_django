# -*- coding: utf-8 -*-import urllib, urllib2import requestsimport jsonimport refrom commands import getstatusoutput as gsoimport psutil#主机信息def get_HostnameInfo():    cmd = "cat /etc/sysconfig/network| grep HOSTNAME| awk -F = '{print $2}'"    status,result=gso(cmd)    if status!=0:        result=0    return result#IP地址def get_Ipaddr():    cmd = "ifconfig eth0|grep 'inet addr'|awk '{print$2}'|awk -F : '{print$2}'"    status,result=gso(cmd)    if status!=0:        result=0    return result#获取版本号def get_OsVerion(file):    with open(file) as fd:        lines = fd.readlines()        os_version = lines[0][:-8]    return os_version#内存def get_MemoryInfo(file):    cmd="free -m|grep -w cache| awk '{print $4}"    status, result = gso(cmd)    if status != 0:        result = 0    return memorydef get_cached(): # 页面缓存内存	cmd="free -m|grep M|awk '{print $7}'"	status, result = gso(cmd)	if status != 0:		result = 0	return resultdef get_buffers(): # 高速缓存区内存	cmd="free -m|grep M|awk '{print $6}'"	status, result = gso(cmd)	if status != 0:		result = 0	return resultdef get_swap(): # 交换分区	cmd="free -m|grep S|awk '{print $3}'"	status, result = gso(cmd)	if status != 0:		result = 0	return result#存储def get_DiskInfo():    cmd="fdisk -l |grep 'Disk' |awk -F , '{print $1}' | sed 's/Disk identifier.*//g' | sed '/^$/d'|awk -F : '{print $2}'"    status,result=gso(cmd)    if status !=0:        result=0    return result#CPUdef get_CpuInfo():    cpu=psutil.cpu_percent(5)    result="%.2f" % cpu    return resultdef main():    hostname=get_HostnameInfo()    ip = get_Ipaddr()    disk = get_DiskInfo()    Cpu_Cores = get_CpuInfo()    cached = get_cached()    buffer = get_buffers()    swap = get_swap()    hostinfo = {        'hostname':hostname,        'ip': ip,        'disk': disk,        'cpucore': Cpu_Cores,        'cached': cached,        'buffer': buffer,        'swap': swap,    }    data = json.dumps(hostinfo)    print hostinfo    print type(hostinfo)    print data    print type(data)    r = requests.post('http://192.168.28.132/apireport', data=data)    print r.status_codeif __name__ == '__main__':	    main()